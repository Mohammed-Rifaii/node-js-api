name: Build and Publish Docker image
on:
    release:
        types: [published]

jobs:
    push-to-docker-up:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3 # i need access to docker.yml in the branch
            - name: Login to dockerHub $ to login to github
              uses: docker/login-action@v2 #to login
              with:
                    username: '${{ secrets.DOCKER_USERNAME }}'
                    password: '${{ secrets.DOCKER_PASSWORD }}'
            - name: Extract metadata
              id: metadata
              uses: docker/metadata-action@v4
              with:
                images: mohammedrifaii00/repo-test
                tags: | #to filter tags and latest will be generated by default
                    type = semver,pattern={{version}}
                    type = semver,pattern= {{major}},{{minor}}
            - name: Build and publish image docker
              uses: docker/build-push-action@v4
              with:
                context: . #root folder
                file: ./Dockerfile # the path to our docker file
                push: true
                tags: ${{steps.metadata.outputs.tags}}
                labels: ${{steps.metadata.outputs.labels}}